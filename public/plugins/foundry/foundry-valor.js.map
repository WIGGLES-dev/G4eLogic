{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/comlink/dist/esm/comlink.mjs","webpack:///./src/plugins/foundry/classes.ts","webpack:///./src/plugins/foundry/hooks.ts","webpack:///./src/plugins/foundry/init.ts","webpack:///./src/plugins/foundry/methods.ts","webpack:///./src/plugins/foundry/styles.css?718e","webpack:///./src/plugins/foundry/sync.ts","webpack:///./src/utils/dom.ts"],"names":[],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,eAAe;AAC9B;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,QAAQ;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,iBAAiB,kBAAkB,WAAW;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,eAAe;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA,oBAAoB;AACpB,SAAS;AACT;AACA;AACA,yDAAyD,eAAe,KAAK;AAC7E;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,EAAE;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,sBAAsB;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,sCAAsC,KAAK;AAC3C,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEsH;AACtH;;;;;;;;;;;;;AC1SA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAwC;AACxC,MAAM,oBAAoB,GAAG;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","file":"plugins/foundry/foundry-valor.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/plugins/foundry/init.ts\");\n","/**\r\n * Copyright 2019 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst proxyMarker = Symbol(\"Comlink.proxy\");\r\nconst createEndpoint = Symbol(\"Comlink.endpoint\");\r\nconst releaseProxy = Symbol(\"Comlink.releaseProxy\");\r\nconst throwMarker = Symbol(\"Comlink.thrown\");\r\nconst isObject = (val) => (typeof val === \"object\" && val !== null) || typeof val === \"function\";\r\n/**\r\n * Internal transfer handle to handle objects marked to proxy.\r\n */\r\nconst proxyTransferHandler = {\r\n    canHandle: (val) => isObject(val) && val[proxyMarker],\r\n    serialize(obj) {\r\n        const { port1, port2 } = new MessageChannel();\r\n        expose(obj, port1);\r\n        return [port2, [port2]];\r\n    },\r\n    deserialize(port) {\r\n        port.start();\r\n        return wrap(port);\r\n    },\r\n};\r\n/**\r\n * Internal transfer handler to handle thrown exceptions.\r\n */\r\nconst throwTransferHandler = {\r\n    canHandle: (value) => isObject(value) && throwMarker in value,\r\n    serialize({ value }) {\r\n        let serialized;\r\n        if (value instanceof Error) {\r\n            serialized = {\r\n                isError: true,\r\n                value: {\r\n                    message: value.message,\r\n                    name: value.name,\r\n                    stack: value.stack,\r\n                },\r\n            };\r\n        }\r\n        else {\r\n            serialized = { isError: false, value };\r\n        }\r\n        return [serialized, []];\r\n    },\r\n    deserialize(serialized) {\r\n        if (serialized.isError) {\r\n            throw Object.assign(new Error(serialized.value.message), serialized.value);\r\n        }\r\n        throw serialized.value;\r\n    },\r\n};\r\n/**\r\n * Allows customizing the serialization of certain values.\r\n */\r\nconst transferHandlers = new Map([\r\n    [\"proxy\", proxyTransferHandler],\r\n    [\"throw\", throwTransferHandler],\r\n]);\r\nfunction expose(obj, ep = self) {\r\n    ep.addEventListener(\"message\", function callback(ev) {\r\n        if (!ev || !ev.data) {\r\n            return;\r\n        }\r\n        const { id, type, path } = Object.assign({ path: [] }, ev.data);\r\n        const argumentList = (ev.data.argumentList || []).map(fromWireValue);\r\n        let returnValue;\r\n        try {\r\n            const parent = path.slice(0, -1).reduce((obj, prop) => obj[prop], obj);\r\n            const rawValue = path.reduce((obj, prop) => obj[prop], obj);\r\n            switch (type) {\r\n                case 0 /* GET */:\r\n                    {\r\n                        returnValue = rawValue;\r\n                    }\r\n                    break;\r\n                case 1 /* SET */:\r\n                    {\r\n                        parent[path.slice(-1)[0]] = fromWireValue(ev.data.value);\r\n                        returnValue = true;\r\n                    }\r\n                    break;\r\n                case 2 /* APPLY */:\r\n                    {\r\n                        returnValue = rawValue.apply(parent, argumentList);\r\n                    }\r\n                    break;\r\n                case 3 /* CONSTRUCT */:\r\n                    {\r\n                        const value = new rawValue(...argumentList);\r\n                        returnValue = proxy(value);\r\n                    }\r\n                    break;\r\n                case 4 /* ENDPOINT */:\r\n                    {\r\n                        const { port1, port2 } = new MessageChannel();\r\n                        expose(obj, port2);\r\n                        returnValue = transfer(port1, [port1]);\r\n                    }\r\n                    break;\r\n                case 5 /* RELEASE */:\r\n                    {\r\n                        returnValue = undefined;\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n        catch (value) {\r\n            returnValue = { value, [throwMarker]: 0 };\r\n        }\r\n        Promise.resolve(returnValue)\r\n            .catch((value) => {\r\n            return { value, [throwMarker]: 0 };\r\n        })\r\n            .then((returnValue) => {\r\n            const [wireValue, transferables] = toWireValue(returnValue);\r\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\r\n            if (type === 5 /* RELEASE */) {\r\n                // detach and deactive after sending release response above.\r\n                ep.removeEventListener(\"message\", callback);\r\n                closeEndPoint(ep);\r\n            }\r\n        });\r\n    });\r\n    if (ep.start) {\r\n        ep.start();\r\n    }\r\n}\r\nfunction isMessagePort(endpoint) {\r\n    return endpoint.constructor.name === \"MessagePort\";\r\n}\r\nfunction closeEndPoint(endpoint) {\r\n    if (isMessagePort(endpoint))\r\n        endpoint.close();\r\n}\r\nfunction wrap(ep, target) {\r\n    return createProxy(ep, [], target);\r\n}\r\nfunction throwIfProxyReleased(isReleased) {\r\n    if (isReleased) {\r\n        throw new Error(\"Proxy has been released and is not useable\");\r\n    }\r\n}\r\nfunction createProxy(ep, path = [], target = function () { }) {\r\n    let isProxyReleased = false;\r\n    const proxy = new Proxy(target, {\r\n        get(_target, prop) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            if (prop === releaseProxy) {\r\n                return () => {\r\n                    return requestResponseMessage(ep, {\r\n                        type: 5 /* RELEASE */,\r\n                        path: path.map((p) => p.toString()),\r\n                    }).then(() => {\r\n                        closeEndPoint(ep);\r\n                        isProxyReleased = true;\r\n                    });\r\n                };\r\n            }\r\n            if (prop === \"then\") {\r\n                if (path.length === 0) {\r\n                    return { then: () => proxy };\r\n                }\r\n                const r = requestResponseMessage(ep, {\r\n                    type: 0 /* GET */,\r\n                    path: path.map((p) => p.toString()),\r\n                }).then(fromWireValue);\r\n                return r.then.bind(r);\r\n            }\r\n            return createProxy(ep, [...path, prop]);\r\n        },\r\n        set(_target, prop, rawValue) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            // FIXME: ES6 Proxy Handler `set` methods are supposed to return a\r\n            // boolean. To show good will, we return true asynchronously ¯\\_(ツ)_/¯\r\n            const [value, transferables] = toWireValue(rawValue);\r\n            return requestResponseMessage(ep, {\r\n                type: 1 /* SET */,\r\n                path: [...path, prop].map((p) => p.toString()),\r\n                value,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n        apply(_target, _thisArg, rawArgumentList) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            const last = path[path.length - 1];\r\n            if (last === createEndpoint) {\r\n                return requestResponseMessage(ep, {\r\n                    type: 4 /* ENDPOINT */,\r\n                }).then(fromWireValue);\r\n            }\r\n            // We just pretend that `bind()` didn’t happen.\r\n            if (last === \"bind\") {\r\n                return createProxy(ep, path.slice(0, -1));\r\n            }\r\n            const [argumentList, transferables] = processArguments(rawArgumentList);\r\n            return requestResponseMessage(ep, {\r\n                type: 2 /* APPLY */,\r\n                path: path.map((p) => p.toString()),\r\n                argumentList,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n        construct(_target, rawArgumentList) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            const [argumentList, transferables] = processArguments(rawArgumentList);\r\n            return requestResponseMessage(ep, {\r\n                type: 3 /* CONSTRUCT */,\r\n                path: path.map((p) => p.toString()),\r\n                argumentList,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n    });\r\n    return proxy;\r\n}\r\nfunction myFlat(arr) {\r\n    return Array.prototype.concat.apply([], arr);\r\n}\r\nfunction processArguments(argumentList) {\r\n    const processed = argumentList.map(toWireValue);\r\n    return [processed.map((v) => v[0]), myFlat(processed.map((v) => v[1]))];\r\n}\r\nconst transferCache = new WeakMap();\r\nfunction transfer(obj, transfers) {\r\n    transferCache.set(obj, transfers);\r\n    return obj;\r\n}\r\nfunction proxy(obj) {\r\n    return Object.assign(obj, { [proxyMarker]: true });\r\n}\r\nfunction windowEndpoint(w, context = self, targetOrigin = \"*\") {\r\n    return {\r\n        postMessage: (msg, transferables) => w.postMessage(msg, targetOrigin, transferables),\r\n        addEventListener: context.addEventListener.bind(context),\r\n        removeEventListener: context.removeEventListener.bind(context),\r\n    };\r\n}\r\nfunction toWireValue(value) {\r\n    for (const [name, handler] of transferHandlers) {\r\n        if (handler.canHandle(value)) {\r\n            const [serializedValue, transferables] = handler.serialize(value);\r\n            return [\r\n                {\r\n                    type: 3 /* HANDLER */,\r\n                    name,\r\n                    value: serializedValue,\r\n                },\r\n                transferables,\r\n            ];\r\n        }\r\n    }\r\n    return [\r\n        {\r\n            type: 0 /* RAW */,\r\n            value,\r\n        },\r\n        transferCache.get(value) || [],\r\n    ];\r\n}\r\nfunction fromWireValue(value) {\r\n    switch (value.type) {\r\n        case 3 /* HANDLER */:\r\n            return transferHandlers.get(value.name).deserialize(value.value);\r\n        case 0 /* RAW */:\r\n            return value.value;\r\n    }\r\n}\r\nfunction requestResponseMessage(ep, msg, transfers) {\r\n    return new Promise((resolve) => {\r\n        const id = generateUUID();\r\n        ep.addEventListener(\"message\", function l(ev) {\r\n            if (!ev.data || !ev.data.id || ev.data.id !== id) {\r\n                return;\r\n            }\r\n            ep.removeEventListener(\"message\", l);\r\n            resolve(ev.data);\r\n        });\r\n        if (ep.start) {\r\n            ep.start();\r\n        }\r\n        ep.postMessage(Object.assign({ id }, msg), transfers);\r\n    });\r\n}\r\nfunction generateUUID() {\r\n    return new Array(4)\r\n        .fill(0)\r\n        .map(() => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(16))\r\n        .join(\"-\");\r\n}\n\nexport { createEndpoint, expose, proxy, proxyMarker, releaseProxy, transfer, transferHandlers, windowEndpoint, wrap };\n//# sourceMappingURL=comlink.mjs.map\n","import { makeIframe } from \"@utils/dom\";\r\nconst vSheetDefaultOptions = {\r\n    classes: [\"foundry-valor\"],\r\n    template: \"systems/GURPS/templates/holder.html\",\r\n    width: 1330,\r\n    height: 700,\r\n    submitOnChange: false\r\n}\r\nexport class VActorSheet extends ActorSheet {\r\n    constructor(...args) {\r\n        super(...args);\r\n    }\r\n    static get defaultOptions() {\r\n        return mergeObject(ActorSheet.defaultOptions, vSheetDefaultOptions)\r\n    }\r\n    activateListeners(jquery) {\r\n        super.activateListeners(jquery);\r\n        const element = jquery[0];\r\n        const { actor } = this;\r\n        const iframe = makeIframe({\r\n            origin: game.GURPS.origin,\r\n            slug: `/#/edit/${actor.data.type}/${actor.id}?hideMenu=true`,\r\n        });\r\n        const sheet = element.closest(\".foundry-valor\");\r\n        const setFrameInactive = e => iframe.style.pointerEvents = \"none\";\r\n        const setFrameActive = e => iframe.style.pointerEvents = \"all\";\r\n        sheet.onmousedown = setFrameInactive;\r\n        sheet.onmouseup = setFrameActive;\r\n        element.append(iframe);\r\n    }\r\n    render(force = false, options = {}) {\r\n        if (this.rendered) return\r\n        return super.render(force, options)\r\n    }\r\n}\r\nexport class VActor extends Actor {\r\n    constructor(...args) {\r\n        super(...args);\r\n    }\r\n    prepareData(...args) {\r\n        super.prepareData(...args);\r\n        const speed = this.data.data?.attributeLevels?.speed;\r\n        const dexterity = this.data.data?.attributeLevels?.dexterity\r\n        const health = this.data.data?.attributeLevels?.health;\r\n        mergeObject(\r\n            this.data.data,\r\n            {\r\n                initiative: speed + (dexterity + health) / 4\r\n            }\r\n        );\r\n    }\r\n}\r\nexport class VItemSheet extends ItemSheet {\r\n    constructor(...args) {\r\n        super(...args)\r\n    }\r\n    static get defaultOptions() {\r\n        return mergeObject(ItemSheet.defaultOptions, vSheetDefaultOptions)\r\n    }\r\n    activateListeners(jquery) {\r\n        super.activateListeners(jquery);\r\n        const element = jquery[0];\r\n        const { item } = this;\r\n        const iframe = makeIframe({\r\n            origin: game.GURPS.origin,\r\n            slug: `/#/edit/${item.data.type}/${item.id}?hideMenu=true`,\r\n        });\r\n        const handle = element.closest(\".foundry-valor\").querySelector(\".window-resizable-handle\");\r\n        handle.onmousedown = e => iframe.style.pointerEvents = \"none\";\r\n        handle.onmouseup = e => iframe.style.pointerEvents = \"all\";\r\n        iframe.onclick = e => jquery.click();\r\n        element.append(iframe);\r\n    }\r\n    render() {\r\n        if (this.rendered) return\r\n        return super.render(...arguments)\r\n    }\r\n}\r\nexport class VApp extends Application {\r\n    constructor(...args) {\r\n        super(...args)\r\n    }\r\n    static get defaultOptions() {\r\n        return mergeObject(ActorSheet.defaultOptions, vSheetDefaultOptions)\r\n    }\r\n}\r\nexport class VItem extends Item {\r\n    constructor(...args) {\r\n        super(...args)\r\n    }\r\n}","import type { System } from \"@internal\";\r\nimport type { Remote } from \"comlink\";\r\nimport { DatabaseChangeType, IDatabaseChange } from \"dexie-observable/api\";\r\nexport enum FoundryHooks {\r\n    DeleteActor = \"deleteActor\",\r\n    PreCreateActor = \"preCreateActor\",\r\n    CreateActor = \"createActor\",\r\n    PreUpdateActor = \"preUpdateActor\",\r\n    UpdateActor = \"updateActor\",\r\n    DeleteItem = \"deleteItem\",\r\n    CreateItem = \"createItem\",\r\n    UpdateItem = \"updateItem\",\r\n    DeleteOwnedItem = \"deleteOwnedItem\",\r\n    CreateOwnedItem = \"createOwnedItem\",\r\n    UpdateOwnedItem = \"updateOwnedItem\",\r\n    RenderActorSheet = \"renderActorSheet\",\r\n    RenderItemSheet = \"renderItemSheet\"\r\n}\r\ntype Connection = Remote<typeof System>;\r\nconst settings = {\r\n    types: {\r\n        character: \"Actor\",\r\n        equipment: \"Item\",\r\n        skill: \"Item\",\r\n        trait: \"Item\"\r\n    }\r\n};\r\nconst timestamps: Record<string, number> = {};\r\nfunction shouldIgnoreUpdate(id, timestamp) {\r\n    return timestamp <= timestamps[id]\r\n}\r\nexport async function handleValorEvent(changes: IDatabaseChange[]) {\r\n    for (const change of changes.slice(-1)) {\r\n        const { key } = change;\r\n        const isActor = game.actors.get(key)?.id === key;\r\n        const entity = game[isActor ? \"actors\" : \"items\"].get(key);\r\n        console.log(change);\r\n        switch (change.type) {\r\n            case DatabaseChangeType.Create: {\r\n                //(settings.types[change.obj.type] === \"Actor\" ? Actor : Item).create({ data: change.obj });\r\n                break\r\n            }\r\n            case DatabaseChangeType.Delete: {\r\n                //entity.delete();\r\n                break\r\n            }\r\n            case DatabaseChangeType.Update: {\r\n                const timestamp = change.obj?.__meta__?.lastEdit;\r\n                timestamps[change.key] = timestamp;\r\n                const {\r\n                    name,\r\n                    image = \"icons/svg/mystery-man.svg\"\r\n                } = change.obj;\r\n                await entity.update({\r\n                    name: name || \"???\",\r\n                    img: image,\r\n                    data: change.obj,\r\n                }, { diff: false });\r\n                break\r\n            }\r\n        }\r\n    }\r\n}\r\nasync function handleCreateEntity(this: Connection, entity, options, userId) {\r\n    const {\r\n        id,\r\n        data\r\n    } = entity;\r\n    const obj = Object.assign(\r\n        {},\r\n        data.data,\r\n        {\r\n            type: data.type,\r\n            id\r\n        }\r\n    );\r\n    await this.add(\"index\", obj, id);\r\n    const sync = await this.get(\"index\", id);\r\n    await entity.update({\r\n        data: sync\r\n    });\r\n}\r\nasync function handleUpdateEntity(this: Connection, entity, d, options, userId) {\r\n    const timestamp = d?.data?.__meta__?.lastEdit;\r\n    const {\r\n        id,\r\n        data\r\n    } = entity;\r\n    if (shouldIgnoreUpdate(entity.id, timestamp)) {\r\n\r\n    } else {\r\n        const obj = Object.assign(\r\n            {},\r\n            d?.data,\r\n            {\r\n                type: data.type,\r\n            }\r\n        );\r\n        this.update(\"index\", id, obj);\r\n    }\r\n}\r\nexport const hookHandlers: Record<string, (this: Connection, ...args) => Promise<void> | false | void> = {\r\n    preCreateActor(data, options, userId) { },\r\n    async createActor(actor, options, userId) {\r\n        await handleCreateEntity.call(this, actor, options, userId);\r\n    },\r\n    preUpdateActor(actor, d, options, userId) {\r\n\r\n    },\r\n    async updateActor(actor, d, options, userId) {\r\n        await handleUpdateEntity.call(this, actor, d, options, userId);\r\n    },\r\n    preDeleteActor(actor, options, userId) { },\r\n    async deleteActor(actor, options, userId) {\r\n        this.delete(\"index\", actor.id);\r\n    },\r\n    preCreateItem(data, options, userId) { },\r\n    async createItem(item, options, userId) {\r\n        await handleCreateEntity.call(this, item, options, userId);\r\n    },\r\n    preUpdateItem(item, d, options, userId) { },\r\n    async updateItem(item, d, options, userId) {\r\n        await handleUpdateEntity.call(this, item, d, options, userId);\r\n    },\r\n    preDeleteItem(item, options, userId) { },\r\n    async deleteItem(item, options, userId) { },\r\n    preCreateOwnedItem() { },\r\n    async createOwnedItem() { },\r\n    preUpdateOwnedItem() { },\r\n    async updateOwnedItem() { },\r\n    preDeleteOwnedItem() { },\r\n    async deleteOwnedItem() { },\r\n\r\n    async renderActorSheet(sheet, html, data) { },\r\n    async renderItemSheet(item, html, data) { }\r\n};","import { foundryMethods } from \"./methods\";\r\nimport { expose, wrap, proxy, windowEndpoint, Remote } from \"comlink\";\r\nimport type { System } from \"@internal\";\r\nimport { VActor, VActorSheet, VItem, VItemSheet } from './classes';\r\nimport { hookHandlers, FoundryHooks, handleValorEvent } from './hooks';\r\nimport { sync } from \"./sync\";\r\nimport { makeIframe } from '@app/utils/dom';\r\nimport \"./styles.css\";\r\nasync function connect<T extends Record<string, any>>(src) {\r\n    const iframe = makeIframe({\r\n        src,\r\n        style: {\r\n            display: \"none\",\r\n        },\r\n        appendTo: document.body\r\n    });\r\n    document.body.appendChild(iframe);\r\n    await new Promise(resolve => iframe.onload = resolve);\r\n    const connection = wrap<T>(windowEndpoint(iframe.contentWindow));\r\n    return {\r\n        iframe,\r\n        connection\r\n    }\r\n}\r\nasync function augment() {\r\n    const dragHandler = SidebarDirectory.prototype[\"_onDragStart\"];\r\n    SidebarDirectory.prototype[\"_onDragStart\"] = async function (event) {\r\n        dragHandler.call(this, event);\r\n        const { id, type } = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\r\n        const entity = await fromUuid(`${type}.${id}`);\r\n        const data = Object.assign({}, entity?.data?.data, { id: randomID(), type })\r\n        event.dataTransfer.setData(\"application/json\", JSON.stringify(data))\r\n    }\r\n}\r\nasync function onFoundryInit() {\r\n    await augment();\r\n    game.GURPS = {\r\n        origin: \"https://valor-59b11.web.app\"\r\n        //origin: \"http://localhost:3000\"\r\n    };\r\n    CONFIG.Combat.initiative = {\r\n        decimals: 2,\r\n        formula: \"@initiative\"\r\n    };\r\n    CONFIG.Actor.entityClass = VActor;\r\n    CONFIG.Item.entityClass = VItem;\r\n    Actors.unregisterSheet(\"core\", ActorSheet);\r\n    Items.unregisterSheet(\"core\", ItemSheet);\r\n    Actors.registerSheet(\"GURPS\", VActorSheet, { makeDefault: true });\r\n    Items.registerSheet(\"GURPS\", VItemSheet, { makeDefault: true });\r\n}\r\nasync function onFoundryReady() {\r\n\r\n}\r\nasync function handleRoll(e) {\r\n    const {\r\n        event,\r\n        data\r\n    } = e;\r\n    const roll = Roll.create(...data);\r\n    const message = await roll.toMessage();\r\n}\r\nasync function syncWithValor() {\r\n    const { connection, iframe } = await connect<typeof System>(game?.GURPS?.origin);\r\n    for (const hook of Object.values(FoundryHooks)) {\r\n        Hooks.on(hook, hookHandlers[hook].bind(connection));\r\n    }\r\n    await sync.call(connection);\r\n    await connection.on(\"dbchanges\", proxy(handleValorEvent));\r\n    await connection.on(\"roll\", proxy(handleRoll));\r\n}\r\ntry {\r\n    if (window && window[\"Hooks\"]) {\r\n        Hooks.on(\"init\", onFoundryInit);\r\n        Hooks.on(\"ready\", onFoundryReady);\r\n        Hooks.on(\"ready\", syncWithValor);\r\n        if (window.parent !== window) {\r\n            expose(foundryMethods, windowEndpoint(window.parent));\r\n        }\r\n    }\r\n} catch (err) {\r\n\r\n}","import type { OrArray } from \"@utils/object\";\r\nexport const foundryMethods = {\r\n    async createItem(data: OrArray<createData>, options?: Options): Promise<OrArray<BaseData>> {\r\n        try {\r\n            const item = await Item.create(data, options);\r\n            return item.data\r\n        } catch (err) {\r\n\r\n        }\r\n    },\r\n    async updateItem(data: OrArray<updateData>, options?: Options): Promise<OrArray<BaseData>> {\r\n        try {\r\n            const item = await Item.update(data, options);\r\n            return item.data\r\n        } catch (err) {\r\n\r\n        }\r\n    },\r\n    async deleteItem(data: OrArray<string>, options?: Options): Promise<OrArray<BaseData>> {\r\n        try {\r\n            const item = await Item.delete(data, options);\r\n            return item.data\r\n        } catch (err) {\r\n\r\n        }\r\n    },\r\n    async createActor(data: OrArray<createData>, options?: Options): Promise<OrArray<BaseData>> {\r\n        try {\r\n            const actor = await Actor.delete(data, options);\r\n            return actor.data\r\n        } catch (err) {\r\n\r\n        }\r\n    },\r\n    async updateActor(data: OrArray<updateData>, options?: Options): Promise<OrArray<BaseData>> {\r\n        try {\r\n            const actor = await Actor.update(data, options);\r\n            return actor.data\r\n        } catch (err) {\r\n\r\n        }\r\n    },\r\n    async deleteActor(data: OrArray<string>, options?: Options) {\r\n        try {\r\n            const actor = await Actor.delete(data, options);\r\n            return actor.data\r\n        } catch (err) {\r\n\r\n        }\r\n    },\r\n    async createOwnedItem(actorId: string, item: OrArray<createData>, options?: Options): Promise<OrArray<BaseData>> {\r\n        try {\r\n            const ownedItem = await game.actors.get(actorId)?.createOwnedItem(item, options);\r\n            return ownedItem.data\r\n        } catch (err) { }\r\n    },\r\n    async updateOwnedItem(actorId: string, item: OrArray<updateData>, options?: Options): Promise<OrArray<BaseData>> {\r\n        try {\r\n            const ownedItem = await game.actors.get(actorId)?.updateOwnedItem(item, options);\r\n            return ownedItem.data\r\n        } catch (err) {\r\n\r\n        }\r\n    },\r\n    async deleteOwnedItem(actorId: string, itemId: OrArray<string>, options?: Options): Promise<OrArray<BaseData>> {\r\n        try {\r\n            const ownedItem = await game.actors.get(actorId)?.deleteOwnedItem(itemId, options);\r\n            return ownedItem.data\r\n        } catch (err) { }\r\n    },\r\n    getGameData() {\r\n        return duplicate(game)\r\n    },\r\n    getActorData(actorId: string): BaseData {\r\n        return game.actors.get(actorId)\r\n    },\r\n    getItemData(itemId: string): BaseData {\r\n        return game.items.get(itemId)?.data\r\n    },\r\n    getOwnedItemData(actorId: string, itemId: string) {\r\n        return game.actors.get(actorId)?.getOwnedItem(itemId)?.data\r\n    },\r\n    notify() { },\r\n    roll(formula, data) {\r\n        Roll.create(formula, data).toMessage();\r\n    },\r\n    openPDF(code: string, options: any) {\r\n        const api = ui.PDFoundry;\r\n        if (!api) return\r\n        try {\r\n            api.openPDFByCode(code, options);\r\n        } catch (err) {\r\n            console.log(err);\r\n        }\r\n    }\r\n}","// extracted by mini-css-extract-plugin\nexport {};","import type { System } from \"@internal\";\r\nimport type { Remote } from \"comlink\";\r\nexport async function sync(this: Remote<typeof System>) {\r\n    try {\r\n        const table = await this.getTable(\"index\");\r\n        const hash = table.reduce((hash, entry) => Object.assign(hash, { [entry.id]: entry }), {});\r\n        const actors = [...game.actors];\r\n        const items = [...game.items];\r\n        const ownedActors = actors.filter(actor => actor.permission === 3);\r\n        const ownedItems = items.filter(item => item.permission === 3);\r\n        for (const entity of [...ownedActors, ...ownedItems]) {\r\n            const entry = hash[entity.id];\r\n            const entryTimestamp = entry?.__meta__?.lastEdit ?? Number.POSITIVE_INFINITY;\r\n            if (entry?.id === entity?.id) {\r\n                const entityTimestamp = entity?.data?.data?.__meta__?.lastEdit ?? Number.NEGATIVE_INFINITY;\r\n                if (entryTimestamp > entityTimestamp) {\r\n                    entity.update({\r\n                        data: entry\r\n                    });\r\n                } else {\r\n                    const data = Object.assign(\r\n                        {},\r\n                        entity.data.data,\r\n                        {\r\n                            type: entity.data.type,\r\n                            id: entity.id\r\n                        }\r\n                    )\r\n                    this.update(\"index\", entity.id, data)\r\n                }\r\n            } else {\r\n                const data = Object.assign(\r\n                    {},\r\n                    entity.data.data,\r\n                    {\r\n                        type: entity.data.type,\r\n                        id: entity.id\r\n                    }\r\n                )\r\n                this.add(\"index\", data, entity.id);\r\n            }\r\n        }\r\n    } catch (err) {\r\n        setTimeout(sync.bind(this), 1000)\r\n    }\r\n}","import { wrap, expose, windowEndpoint, transferHandlers, Remote } from \"comlink\";\r\nexport function upload() {\r\n    return new Promise<FileList>((resolve, reject) => {\r\n        Object.assign(document.createElement(\"input\"), {\r\n            type: \"file\",\r\n            async onchange(this: HTMLInputElement) {\r\n                resolve(this.files)\r\n            }\r\n        }).click();\r\n    });\r\n}\r\n\r\nexport function download(href: string, filename: string) {\r\n    Object.assign(document.createElement(\"a\"), {\r\n        href,\r\n        filename\r\n    }).click();\r\n}\r\nexport function inIframe() {\r\n    return window && window.parent !== window\r\n}\r\nexport function makeIframe({\r\n    origin = window.origin,\r\n    slug = \"\",\r\n    src = origin + slug,\r\n    style = {\r\n        width: \"100%\",\r\n        height: \"100%\",\r\n        border: \"none\"\r\n    } as any,\r\n    appendTo = null\r\n}) {\r\n    const iframe = document.createElement(\"iframe\");\r\n    Object.assign(iframe.style, style);\r\n    iframe.src = src;\r\n    if (appendTo instanceof HTMLElement) {\r\n        appendTo.append(iframe);\r\n    }\r\n    return iframe;\r\n}\r\nexport async function bubble(frame: HTMLIFrameElement) {\r\n    if (!frame.contentDocument) await new Promise(resolve => frame.onload = resolve);\r\n    console.log(frame, frame.contentDocument);\r\n    const target = frame?.contentDocument;\r\n    target.onmousemove = (e) => {\r\n        const bounding = frame.getBoundingClientRect();\r\n        const event = new MouseEvent(\"mousemove\", {\r\n            ...e,\r\n            screenX: e.screenX + bounding.left,\r\n            clientX: e.clientX + bounding.left,\r\n            screenY: e.clientY + bounding.top,\r\n            clientY: e.clientY + bounding.top,\r\n        });\r\n        window.dispatchEvent(event);\r\n    }\r\n    target.onclick = (e) => {\r\n        const bounding = frame.getBoundingClientRect();\r\n        const event = new MouseEvent(\"click\", {\r\n            ...e,\r\n            screenX: e.screenX + bounding.left,\r\n            clientX: e.clientX + bounding.left,\r\n            screenY: e.clientY + bounding.top,\r\n            clientY: e.clientY + bounding.top,\r\n        });\r\n        console.log(\"CLICK\");\r\n        window.dispatchEvent(event);\r\n    }\r\n    target.onkeypress = (e) => {\r\n        const event = new MouseEvent(\"keypress\", {\r\n            ...e\r\n        });\r\n        window.dispatchEvent(event);\r\n    }\r\n    target.onmouseup = (e) => {\r\n        const bounding = frame.getBoundingClientRect();\r\n        const event = new MouseEvent(\"mouseup\", {\r\n            ...e,\r\n            screenX: e.screenX + bounding.left,\r\n            clientX: e.clientX + bounding.left,\r\n            screenY: e.clientY + bounding.top,\r\n            clientY: e.clientY + bounding.top,\r\n        });\r\n        window.dispatchEvent(event);\r\n    }\r\n    target.onmousedown = (e) => {\r\n        const bounding = frame.getBoundingClientRect();\r\n        const event = new MouseEvent(\"mousedown\", {\r\n            ...e,\r\n            screenX: e.screenX + bounding.left,\r\n            clientX: e.clientX + bounding.left,\r\n            screenY: e.clientY + bounding.top,\r\n            clientY: e.clientY + bounding.top,\r\n        });\r\n        frame.parentElement.dispatchEvent(event);\r\n    }\r\n    target.onscroll = (e) => {\r\n        frame.ownerDocument.body.scrollTop = frame.ownerDocument.body.scrollHeight;\r\n    }\r\n}\r\nexport function getRoot(element: HTMLElement) {\r\n    const rootNode = element.getRootNode()\r\n    if (rootNode instanceof Document || rootNode.nodeName === \"#document\") {\r\n        return (rootNode as Document).body\r\n    } else if (rootNode instanceof ShadowRoot) {\r\n        return rootNode.appendChild(document.createElement(\"div\"));\r\n    } else {\r\n        return document.body\r\n    }\r\n}\r\nexport class VirtualElement {\r\n    element: ClientRect | DOMRect\r\n\r\n    constructor(element?: Partial<ClientRect | DOMRect> | HTMLElement | MouseEvent) {\r\n        if (element instanceof MouseEvent) {\r\n            const { clientX, clientY } = element;\r\n            this.element = this.generateGetBoundingClientRect(clientX, clientY);\r\n        }\r\n        else {\r\n            const bb = element instanceof HTMLElement ? element.getBoundingClientRect() : element;\r\n            this.element = Object.assign(this.generateGetBoundingClientRect(), bb);\r\n        }\r\n    }\r\n    getBoundingClientRect(): ClientRect | DOMRect {\r\n        return this.element\r\n    }\r\n    generateGetBoundingClientRect(x = 0, y = 0): ClientRect | DOMRect {\r\n        return {\r\n            width: 0,\r\n            height: 0,\r\n            top: y,\r\n            right: x,\r\n            bottom: y,\r\n            left: x,\r\n        };\r\n    }\r\n    update(x, y) {\r\n        this.element = this.generateGetBoundingClientRect(x, y);\r\n        return this\r\n    }\r\n}\r\nexport interface EventHandlerOptions {\r\n    target\r\n    coerce: typeof Number | typeof Boolean | typeof String\r\n}\r\nexport function handleEvent(options: EventHandlerOptions) {\r\n    function doChange(value, cast?) {\r\n        const { target, coerce } = options;\r\n        if (target) {\r\n            const toSend = coerce || cast ? (coerce || cast)(value) : value\r\n            if (typeof target.next === \"function\") {\r\n                target.next(toSend);\r\n            } else if (typeof target.set === \"function\") {\r\n                target.set(toSend);\r\n            }\r\n        }\r\n    }\r\n    return function (this: Event, e: Event) {\r\n        const target = e.target;\r\n        if (target instanceof HTMLElement) {\r\n            if (target instanceof HTMLInputElement) {\r\n                if (target.type === \"number\") {\r\n                    doChange(target.value, Number)\r\n                } else if (target.type === \"checkbox\") {\r\n                    doChange(target.value, Boolean)\r\n                } else if (target.type === \"text\") {\r\n                    doChange(target.value, String)\r\n                }\r\n            } else if (target instanceof HTMLSelectElement || target instanceof HTMLTextAreaElement) {\r\n                doChange(target.value, String);\r\n            } else if (target.isContentEditable) {\r\n                doChange(target.innerHTML)\r\n            }\r\n        }\r\n    }\r\n}\r\nexport function initiateEvent(event: string, data: EventInit, coordinates: [number, number]) {\r\n    new Event(event, data)\r\n}\r\nexport function initProxyEventDispatcher() {\r\n    try {\r\n        if (window.parent === window) {\r\n            expose(initiateEvent, windowEndpoint(window.parent));\r\n        }\r\n    } catch (err) {\r\n        \r\n    }\r\n}\r\n\r\nexport function dispatchEventToIframe(iframe: HTMLIFrameElement) {\r\n\r\n}"],"sourceRoot":""}